<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="favicon.ico"/>
  <title>เพิ่มคำถามใหม่</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .teacher-dashboard{
      padding:20px;max-width:1200px;margin:auto;background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)
    }
    form{display:flex;flex-direction:column;gap:15px}
    form label{font-weight:bold}
    form input[type="text"],form textarea,form select{
      width:200px;padding:10px;border-radius:5px;border:1px solid #ddd;font-size:1.05em
    }
    .difficulty-select{width:200px;font-size:1.05em}
    form button{align-self:flex-start}
  </style>
</head>
<body>
<header>
  <img src="nulogo.png" alt="Logo" height="80"/>
    <div class="course-title">
        <h2>เพิ่มคำถามใหม่</h2>
    </div>
  <div class="top-right">
    <button id="backBtn" class="action-button">กลับคลังข้อสอบ</button>
    <button id="logoutBtn" class="logout-btn">ออกจากระบบ</button>
  </div>
</header>

<main class="teacher-dashboard">
  <h1 style="color:#2563eb;margin-bottom:10px;">เพิ่มคำถามใหม่</h1>
  <div style="margin-bottom:24px;color:#555;font-size:1.1em;">กรุณากรอกข้อมูลให้ครบถ้วนทุกช่อง</div>

  <form id="questionForm" style="background:#f8f9fa;border-radius:12px;box-shadow:0 2px 8px rgba(30,41,59,0.06);padding:32px 24px;max-width:600px;margin:auto;">
    <label for="questionText">คำถาม:</label>
    <textarea id="questionText" name="question_text" rows="3" required style="font-size:1.1em;"></textarea>

    <label style="margin-top:10px;">ตัวเลือก:</label>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <input type="text" name="choices[A]" placeholder="ตัวเลือก A" required />
      <input type="text" name="choices[B]" placeholder="ตัวเลือก B" required />
      <input type="text" name="choices[C]" placeholder="ตัวเลือก C" required />
      <input type="text" name="choices[D]" placeholder="ตัวเลือก D" required />
    </div>

    <label for="correctChoice" style="margin-top:10px;">คำตอบที่ถูกต้อง:</label>
    <select id="correctChoice" name="correct_choice" required>
      <option value="A">A</option>
      <option value="B">B</option>
      <option value="C">C</option>
      <option value="D">D</option>
    </select>

    <label for="difficultyLevel" style="margin-top:10px;">ระดับความยาก:</label>
    <select id="difficultyLevel" name="difficulty_level" class="difficulty-select" required>
      <option value="1">ง่าย</option>
      <option value="2">ปานกลาง</option>
      <option value="3">ยาก</option>
    </select>

    <button type="submit" class="action-button" style="margin-top:18px;font-size:1.1em;padding:12px 32px;">บันทึกคำถาม</button>
  </form>
</main>

<script>
  const questionForm = document.getElementById('questionForm');
  const teacherToken = localStorage.getItem('teacherToken');

  // ตรวจสอบ Token ก่อน
  if (!teacherToken) {
    alert('กรุณาเข้าสู่ระบบสำหรับอาจารย์ก่อน');
    window.location.href = 'teacher_login.html';
  }

  // ส่งฟอร์ม
  questionForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const formData = new FormData(questionForm);
    const data = {
      question_text: formData.get('question_text'),
      choices: {
        A: formData.get('choices[A]'),
        B: formData.get('choices[B]'),
        C: formData.get('choices[C]'),
        D: formData.get('choices[D]')
      },
      correct_choice: formData.get('correct_choice'),
      difficulty_level: formData.get('difficulty_level')
    };

    try {
      const response = await fetch('api/create_question.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + teacherToken
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (response.ok) {
        alert('เพิ่มคำถามสำเร็จ!');
        window.location.href = 'question_bank.html';
      } else {
        throw new Error(result.message || 'เกิดข้อผิดพลาดในการบันทึกข้อมูล');
      }
    } catch (error) {
      alert(`เกิดข้อผิดพลาด: ${error.message}`);
    }
  });

  // ปุ่มกลับ
  document.getElementById('backBtn').addEventListener('click', () => {
    window.location.href = 'question_bank.html';
  });

  // ปุ่ม Logout
  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('teacherToken');
    window.location.href = 'teacher_login.html';
  });
</script>
</body>
</html>
