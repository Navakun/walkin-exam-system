<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>เข้าสู่ระบบอาจารย์</title>
    <link rel="stylesheet" href="assets/css/login.css">
    <link rel="stylesheet" href="assets/css/teacher.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="icon" href="data:,"> <!-- กัน 404 favicon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<style>
    .teacherLoginForm {
        font-family: 'Sarabun', sans-serif;
    }
</style>

<body>

    <header>
        <div class="logo-text">
            <img src="nulogo.png" alt="Logo" height="80">
            <div class="course-title">
                <h2>รายวิชา 273252 กฎหมายเทคโนโลยีสารสนเทศ มหาวิทยาลัยนเรศวร</h2>
            </div>
        </div>
        <div class="top-right">
            <a href="homepage.html" class="home-btn">
                <i class="fas fa-home"></i> หน้าหลัก
            </a>
        </div>
    </header>

    <main class="login-box">
        <h2>อาจารย์ผู้สอน</h2>

        <form id="teacherLoginForm">
            <input type="text" name="username" placeholder="Instructor ID or Email" required>
            <input type="password" name="password" placeholder="Password" required>
            <div id="errorMessage" style="color:#dc3545"></div>
            <button type="submit">Log in</button>
        </form>
    </main>

    <script>
        document.getElementById('teacherLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const errorBox = document.getElementById('errorMessage');
            errorBox.textContent = '';

            const data = Object.fromEntries(new FormData(e.currentTarget).entries());
            try {
                const resp = await fetch('api/teacher_login.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                    cache: 'no-store'
                });
                const raw = await resp.text();
                let result;
                try { result = JSON.parse(raw); }
                catch { throw new Error('เซิร์ฟเวอร์ตอบกลับไม่ใช่ JSON: ' + raw.slice(0, 120)); }

                if (!resp.ok || result.status !== 'success') {
                    errorBox.textContent = result?.message || `HTTP ${resp.status}`;
                    return;
                }
                localStorage.setItem('teacherToken', result.token);
                localStorage.setItem('instructor_id', result.instructor.instructor_id);
                localStorage.setItem('instructor_name', result.instructor.name);
                location.href = 'teacher_dashboard.html';
            } catch (err) {
                errorBox.textContent = err.message || 'เชื่อมต่อเซิร์ฟเวอร์ไม่สำเร็จ';
                console.error(err);
            }
        });
    </script>

</body>

</html>